> 本文的重点是研究多线程和队列的配置使用，以及如何正确回收与队列打完交道的线程。


#### 用到的技术

- 多线程
- python中的队列，由于是demo，就没用公用消息队列了
- 一些爬虫基础知识


#### 程序逻辑

生产者：
1. 分次数获取指定数量网页中的全部图像url，每一次获取完一个网页内的所有url中的图片url，将该网页中所有图片url存入一个列表中，再放入队列中；
2. 如果所有网页中的图像url都获取完并且放入了队列后，生产者线程执行完成，线程回收。
3. 主线程等所有的生产者执行完后，在队列里放入与消费者线程数量相等的None。

消费者：
1. 死循环，当从队列里获取到的值是None时线程结束，如果不是None，则说明生产者还未全部生产完；
2. 从队列中获取到图像url列表，遍历并下载图片到本地。


**为什么主线程要等生产完后，将与消费者数量相等的None放入队列呢？**
1. 原始代码是消费者如果判断为空，那么就线程结束，这样做会导致生产者可能还没生产完，就已经没有消费者消费了，导致消息积压在队列里；
2. 消费者线程退出后，如果生产者生产至队满了，但是还没有完全生产完，将导致生产者线程一直阻塞，整个程序假死；
3. 将消费者线程代码逻辑更改为如果消费到的队列内容是None（意味着生产者全部生产完），就可以完美保证队列里面的消息已经被全部消费完了。


缺点：
1. 容易被斗图啦网站ban IP，注意使用代理池
